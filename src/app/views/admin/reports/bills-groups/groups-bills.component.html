<div class="animated fadeIn row">
  <div class="col-12">
    <div
      class=" text-left justify-content-end card m-0 card-info bg-gray-300 p-sm-2 "
    >
      <div class="text-center col-12 " [formGroup]="selectedItem1">
        <div class="row text-center">
          <!--date-->
          <div class="col-12 mb-md-2 mb-sm-2 mb-lg-2 col-lg-5 col-xl-4">
            <div class="input-group">
              <div class="input-group-prepend">
                <label class="input-group-text">بازه زمانی</label>
              </div>
              <select class="col form-control" formControlName="time">
                <option value="0">همه زمان ها</option>
                <option value="1">یک روز اخیر</option>
                <option value="30">یک ماه اخیر </option>
                <option value="365"> یک سال اخیر</option>
                <option value="-1">انتخابی...</option>
              </select>
            </div>
          </div>
          <div
            class="col-12 mb-md-2 mb-sm-2 mb-lg-2 col-lg-7 col-xl-8"
            [hidden]="selectedItem1.value.time != '-1'"
          >
            <div class="bg-gray-200 p-1 rounded row text-right">
              <div class=" col-6">
                <span>از تاریخ:</span>
                <md-input-container class="date-filter">
                  <input
                    class="form-control-sm p-0 border"
                    mdInput
                    name="someName"
                    dir="rtl"
                    mode="day"
                    theme="dp-material"
                    placeholder="تاریخ"
                    [formControl]="selectedDateFrom"
                    [dpDayPicker]="datePickerConfig"
                    (onSelect)="onSelectDate()"
                  />
                </md-input-container>
              </div>
              <div class=" col-6 ">
                <span>تا تاریخ:</span>
                <md-input-container class="date-filter">
                  <input
                    class="form-control-sm p-0 border"
                    mdInput
                    name="someName"
                    dir="rtl"
                    mode="day"
                    theme="dp-material"
                    placeholder="تاریخ"
                    [formControl]="selectedDateTo"
                    [dpDayPicker]="datePickerConfig"
                    (onSelect)="onSelectDate()"
                  />
                </md-input-container>
              </div>
            </div>
          </div>
          <!--/date-->

          <div class="col-12 col-lg-10 col-xl-10">
            <div class="row">
              <div class="mb-md-2 mb-sm-2 mb-lg-2 col-12 col-xl-12 ">
                <div class="row">
                  <div class="input-group col-xl-2">
                    <div class="input-group-prepend">
                      <label class="input-group-text">نوع</label>
                    </div>
                    <select
                      class="col form-control"
                      formControlName="level"
                      (change)="updateDropdownsData()"
                    >
                      <option value="0">معاونت</option>
                      <option value="1">اداره</option>
                      <option value="2">داخلی </option>
                    </select>
                  </div>

                  <ng-multiselect-dropdown
                    class="form-control col-3 p-0 "
                    [placeholder]="'انتخاب معاونت '"
                    [data]="groups"
                    formControlName="main"
                    [settings]="mainDropdownSettings"
                    (onSelect)="onMainSelect($event)"
                    (onDeSelect)="onDeSelectMain()"
                    (onSelectAll)="updateLines()"
                    (onDeSelectAll)="updateLines()"
                  >
                  </ng-multiselect-dropdown>

                  <ng-multiselect-dropdown
                    *ngIf="selectedItem1.value.level != 0"
                    class="form-control col-3 p-0 "
                    [disables]="selectedItem1.value.main.length == 0"
                    [placeholder]="'انتخاب اداره '"
                    [data]="activeSub1_1"
                    formControlName="sub1"
                    [settings]="officeDropdownSettings"
                    (onSelect)="officeSelected($event)"
                    (onDeSelect)="onDeSelectSub1($event)"
                    (onDeSelectAll)="onDeSelectSub1($event)"
                    (onSelectAll)="updateLines()"
                    (onDeSelectAll)="updateLines()"
                  >
                  </ng-multiselect-dropdown>

                  <ng-multiselect-dropdown
                    *ngIf="selectedItem1.value.level == 2"
                    class="form-control col-4 p-0 "
                    [placeholder]="'انتخاب داخلی '"
                    [data]="lines"
                    formControlName="sub2"
                    [settings]="lineDropdownSettings"
                  >
                  </ng-multiselect-dropdown>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-2 col-xl-2 border-left">
            <button
              class="btn btn-success"
              [disabled]="loadingData"
              (click)="getBillsData()"
            >
              {{ loadingData ? "در حال دریافت اطلاعات" : "نمایش قبض" }}
              <i [hidden]="loadingData" class="fa fa-check"></i>
              <i [hidden]="!loadingData" class="fa fa-spinner fa-spin"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="animated fadeIn row">
  <div class="col-12">
    <div class="card card-accent-primary">
      <div class="card-header">
        اطلاعات قبض
        <button class="btn btn-primary btn-sm" (click)="printModal.show()">
          پرینت قبض <i class="fa fa-print"></i>
        </button>
      </div>
      <div class="card-body">
        <ngx-datatable
          #billsTable
          class="material expandable"
          [rows]="bills"
          [columnMode]="'force'"
          [headerHeight]="50"
          [footerHeight]="50"
          [rowHeight]="'auto'"
          [externalPaging]="true"
          [count]="page.totalElements"
          [offset]="page.pageNumber"
          [limit]="page.size"
          (page)="setPage($event)"
          [limit]="1"
          [width]="100"
          style="width:100%"
        >
          <ngx-datatable-column name="id" [width]="30">
            <ng-template let-column="column" ngx-datatable-header-template>
              ردیف
            </ng-template>
            <ng-template
              let-rowIndex="rowIndex"
              let-row="row"
              let-value="value"
              ngx-datatable-cell-template
            >
              {{ rowIndex + 1 }}
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="name" [width]="100">
            <ng-template
              let-column="column"
              let-sort="sortFn"
              ngx-datatable-header-template
            >
              <span (click)="sort()"> نام</span>
            </ng-template>
            <ng-template
              let-value="value"
              let-rowIndex="rowIndex"
              ngx-datatable-cell-template
            >
              <span>
                {{ value }}
              </span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="mobile" [width]="100">
            <ng-template
              let-column="column"
              let-sort="sortFn"
              ngx-datatable-header-template
            >
              <span (click)="sort()">هزینه موبایل</span>
            </ng-template>
            <ng-template
              let-value="value"
              let-rowIndex="rowIndex"
              ngx-datatable-cell-template
            >
              <span>
                {{ value }}
              </span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="betweanco" [width]="100">
            <ng-template
              let-column="column"
              let-sort="sortFn"
              ngx-datatable-header-template
            >
              <span (click)="sort()">هزینه بین شهری</span>
            </ng-template>
            <ng-template
              let-value="value"
              let-rowIndex="rowIndex"
              ngx-datatable-cell-template
            >
              <span>
                {{ value }}
              </span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="abonmah" [width]="100">
            <ng-template
              let-column="column"
              let-sort="sortFn"
              ngx-datatable-header-template
            >
              <span (click)="sort()">آبونمان</span>
            </ng-template>
            <ng-template
              let-value="value"
              let-rowIndex="rowIndex"
              ngx-datatable-cell-template
            >
              <span> {{ value | number }} ریال </span>
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column name="co" [width]="100">
              <ng-template
                let-column="column"
                let-sort="sortFn"
                ngx-datatable-header-template
              >
                <span (click)="sort()">هزینه شهری</span>
              </ng-template>
              <ng-template
                let-value="value"
                let-rowIndex="rowIndex"
                ngx-datatable-cell-template
              >
                <span> {{ value | number }} ریال </span>
              </ng-template>
            </ngx-datatable-column>

          <ngx-datatable-column name="sum" [width]="100">
            <ng-template
              let-column="column"
              let-sort="sortFn"
              ngx-datatable-header-template
            >
              <span (click)="sort()">جمع</span>
            </ng-template>
            <ng-template
              let-value="value"
              let-rowIndex="rowIndex"
              ngx-datatable-cell-template
            >
              <span> {{ value | number }} ریال </span>
            </ng-template>
          </ngx-datatable-column>

             <ngx-datatable-column name="sum" [width]="100">
              <ng-template
                let-column="column"
                ngx-datatable-header-template
              >
               عملیات
              </ng-template>
              <ng-template
                let-value="value"
                let-rowIndex="rowIndex"
                ngx-datatable-cell-template
              >

              <div style="display:none">
                <div  id="print-item-{{rowIndex}}">
                <table 
                 
                  style="border:1px solid grey; 
                  border-collapse:collapse;
                  width:100%; direction: rtl; 
                  font-family: IRANSans;
                  font-size:14px;"
                  >
                  <div class="bg-gray-100 p-4 text-right">قبض از تاریخ {{selectedDateFrom.value}} تا تاریخ  {{selectedDateTo.value}}</div>
                    <tr style="border-bottom:1px solid grey;">
                        <th>نام</th>
                        <td>{{ bills[rowIndex]['name'] }}</td>
                      </tr>
                     
                      <tr> <th> هزینه موبایل</th><td>{{ bills[rowIndex]['mobile'] | number }}</td></tr>
                      <tr><th> هزینه شهری</th><td>{{ bills[rowIndex]['co']  | number }}</td> </tr>
                      <tr><th> هزینه بین شهری</th><td>{{ bills[rowIndex]['betweanco'] | number }}</td> </tr>
                      <tr><th>آبونمان</th><td>{{ bills[rowIndex]['abonmah']  | number }} ریال</td> </tr>
                      <tr><th>جمع</th><td>{{ bills[rowIndex]['sum'] | number }} ریال</td> </tr>
                      
                     
                </table>
              </div>
              </div>
                <button 
                  class="btn btn-sm btn-primary"
                  class="btn btn-primary mr-2"
                  printTitle="گزارش قبض {{bills[rowIndex]}}"
                  printSectionId="print-item-{{rowIndex}}"
                  styleSheetFile= "./font.css"
                  ngxPrint
                >پرینت<i class="fa fa-print"></i></button>

                
              </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>
      </div>
    </div>
  </div>
</div>

<div
  bsModal
  #printModal="bs-modal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl modal-primary" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button
          type="button"
          class="close"
          (click)="printModal.hide()"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">پرینت قبض</h4>
      </div>
      <div class="modal-body">
        <div class="animated fadeIn row border-bottom justify-content-center">
          <div class="col-10" id="print-section">
            <style>
              @font-face {
                font-family: IRANSans;
                font-style: normal;
                font-weight: bold;
                src: url("assets/fonts/eot/IRANSansWeb_Bold.eot");
                src: url("assets/fonts/eot/IRANSansWeb_Bold.eot?#iefix")
                    format("embedded-opentype"),
                  /* IE6-8 */ url("assets/fonts/woff2/IRANSansWeb_Bold.woff2")
                    format("woff2"),
                  /* FF39+,Chrome36+, Opera24+*/
                    url("assets/fonts/woff/IRANSansWeb_Bold.woff")
                    format("woff"),
                  /* FF3.6+, IE9, Chrome6+, Saf5.1+*/
                    url("assets/fonts/ttf/IRANSansWeb_Bold.ttf")
                    format("truetype");
              }
              @font-face {
                font-family: IRANSans;
                font-style: normal;
                font-weight: 500;
                src: url("assets/fonts/eot/IRANSansWeb_Medium.eot");
                src: url("assets/fonts/eot/IRANSansWeb_Medium.eot?#iefix")
                    format("embedded-opentype"),
                  /* IE6-8 */ url("assets/fonts/woff2/IRANSansWeb_Medium.woff2")
                    format("woff2"),
                  /* FF39+,Chrome36+, Opera24+*/
                    url("assets/fonts/woff/IRANSansWeb_Medium.woff")
                    format("woff"),
                  /* FF3.6+, IE9, Chrome6+, Saf5.1+*/
                    url("assets/fonts/ttf/IRANSansWeb_Medium.ttf")
                    format("truetype");
              }
              @font-face {
                font-family: IRANSans;
                font-style: normal;
                font-weight: 300;
                src: url("assets/fonts/eot/IRANSansWeb_Light.eot");
                src: url("assets/fonts/eot/IRANSansWeb_Light.eot?#iefix")
                    format("embedded-opentype"),
                  /* IE6-8 */ url("assets/fonts/woff2/IRANSansWeb_Light.woff2")
                    format("woff2"),
                  /* FF39+,Chrome36+, Opera24+*/
                    url("assets/fonts/woff/IRANSansWeb_Light.woff")
                    format("woff"),
                  /* FF3.6+, IE9, Chrome6+, Saf5.1+*/
                    url("assets/fonts/ttf/IRANSansWeb_Light.ttf")
                    format("truetype");
              }
              @font-face {
                font-family: IRANSans;
                font-style: normal;
                font-weight: 200;
                src: url("assets/fonts/eot/IRANSansWeb_UltraLight.eot");
                src: url("assets/fonts/eot/IRANSansWeb_UltraLight.eot?#iefix")
                    format("embedded-opentype"),
                  /* IE6-8 */
                    url("assets/fonts/woff2/IRANSansWeb_UltraLight.woff2")
                    format("woff2"),
                  /* FF39+,Chrome36+, Opera24+*/
                    url("assets/fonts/woff/IRANSansWeb_UltraLight.woff")
                    format("woff"),
                  /* FF3.6+, IE9, Chrome6+, Saf5.1+*/
                    url("assets/fonts/ttf/IRANSansWeb_UltraLight.ttf")
                    format("truetype");
              }
              @font-face {
                font-family: IRANSans;
                font-style: normal;
                font-weight: normal;
                src: url("assets/fonts/eot/IRANSansWeb.eot");
                src: url("assets/fonts/eot/IRANSansWeb.eot?#iefix")
                    format("embedded-opentype"),
                  /* IE6-8 */ url("assets/fonts/woff2/IRANSansWeb.woff2")
                    format("woff2"),
                  /* FF39+,Chrome36+, Opera24+*/
                    url("assets/fonts/woff/IRANSansWeb.woff") format("woff"),
                  /* FF3.6+, IE9, Chrome6+, Saf5.1+*/
                    url("assets/fonts/ttf/IRANSansWeb.ttf") format("truetype");
              }
            </style>
            <table
              cellpadding="10"
              style="border:1px solid grey; 
                 border-collapse:collapse;
                 width:100%; direction: rtl; 
                 font-family: IRANSans;
                 font-size:14px;"
            >
              <tr style="border-bottom:1px solid grey;">
                <th>ردیف</th>
                <th>نام</th>
                <th> هزینه موبایل</th>
                <th> هزینه شهری</th>
                <th> هزینه بین شهری</th>
                <th>آبونمان</th>
                <th>جمع</th>
              </tr>
              <tr
                *ngFor="let item of bills; let i = index"
                style="border-bottom:1px solid grey;font-size:12px;"
              >
                <td>{{ i + 1 }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.mobile | number }}</td>
                <td>{{ item.co | number }}</td>
                <td>{{ item.betweanco | number }}</td>
                <td>{{ item.abonmah | number }} ریال</td>
                <td>{{ item.sum | number }} ریال</td>
              </tr>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary mr-2"
            (click)="printModal.hide()"
          >
            انصراف
          </button>
          <button
            type="button"
            class="btn btn-primary mr-2"
            printTitle="گزارش قبوض"
            printSectionId="print-section"
            ngxPrint
          >
            پرینت
          </button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
  <!-- /.modal -->
</div>



